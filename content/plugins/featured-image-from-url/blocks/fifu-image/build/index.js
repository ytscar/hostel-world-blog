(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,n=window.React;var i=e.n(n);window.wp.i18n;const a=window.wp.blockEditor,l=window.wp.components,o=window.wp.element,{toggleEditorPanelEnabled:u}=(window.wp.domReady,wp.data.dispatch("core/edit-post")),{isEditorPanelEnabled:d}=wp.data.select("core/edit-post");(0,t.registerBlockType)("fifu/image",{edit:function({attributes:e,setAttributes:t}){const c=(0,a.useBlockProps)(),{imageUrl:r,altText:s}=e,[f,w]=i().useState(!1);if((0,o.useEffect)(()=>{const e=document.getElementById("fifu_input_url"),n=document.getElementById("fifu_input_alt");let i=!1,a={};if(e){const t=e.value.trim();t&&t!==r&&(a.imageUrl=t,i=!0)}if(n){const e=n.value.trim();e&&e!==s&&(a.altText=e,i=!0)}i&&t(a)},[]),(0,o.useEffect)(()=>{const e=document.getElementById("fifu_input_url"),t=document.getElementById("fifu_input_alt");e&&e.value!==(r||"")&&("function"==typeof window.removeImage&&window.removeImage(!1),e.value=r||"",e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),"function"==typeof window.previewImage&&setTimeout(window.previewImage,100)),t&&t.value!==(s||"")&&(t.value=s||"",t.dispatchEvent(new Event("input",{bubbles:!0})),t.dispatchEvent(new Event("change",{bubbles:!0}))),document.querySelectorAll("#the-list tr").forEach(e=>{const t=e.querySelector('input[type="text"][name$="[key]"]'),n=e.querySelector('textarea[name$="[value]"]');t&&n&&("fifu_image_url"===t.value&&n.value!==(r||"")&&(n.value=r||"",n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))),"fifu_image_alt"===t.value&&n.value!==(s||"")&&(n.value=s||"",n.dispatchEvent(new Event("input",{bubbles:!0})),n.dispatchEvent(new Event("change",{bubbles:!0}))))}),window.__fifuLastImageUrl=r||"",window.__fifuLastAltText=s||""},[r,s]),"undefined"!=typeof window&&"undefined"!=typeof wp&&wp.data&&wp.data.select&&!window.__fifuMetaBoxSubscribed){function p(){const e=wp.data.select("core/block-editor").getBlocks(),t=e.some(e=>"fifu/image"===e.name),n=document.getElementById("imageUrlMetaBox"),i=document.getElementById("fifu_input_url"),a=document.getElementById("fifu_input_alt");n&&(n.style.display=t?"none":"");const l=window.__fifuPrevHasBlock;if(void 0===l&&(window.__fifuPrevHasBlock=t),t&&!1===l&&i&&!window.__fifuSyncing){const t=i.value.trim(),n=a?a.value.trim():"",l=e.find(e=>"fifu/image"===e.name);if(l&&(t||n)){window.__fifuSyncing=!0;let e={};t&&(e.imageUrl=t),n&&(e.altText=n),wp.data.dispatch("core/block-editor").updateBlockAttributes(l.clientId,e),setTimeout(()=>window.__fifuSyncing=!1,0)}}t||!0!==l||(i&&(i.value=window.__fifuLastImageUrl||"",i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))),a&&(a.value=window.__fifuLastAltText||"",a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0})))),window.__fifuPrevHasBlock=t}function g(){if(document.getElementById("imageUrlMetaBox"))p(),wp.data.subscribe(p);else{const e=new MutationObserver(()=>{document.getElementById("imageUrlMetaBox")&&(p(),wp.data.subscribe(p),e.disconnect())});e.observe(document.body,{childList:!0,subtree:!0})}}window.__fifuMetaBoxSubscribed=!0,window.__fifuSyncing=!1,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",g):g()}const m=()=>{const e=wp.data.select("core/block-editor").getBlocks().some(e=>"fifu/image"===e.name),t=document.getElementById("fifu_input_url"),n=t&&t.value&&t.value.trim(),i=!d||d("featured-image");(e||n)&&i?u("featured-image"):e||n||i||u("featured-image")};return m(),wp.data.subscribe(m),(0,n.createElement)("div",{...c},(0,n.createElement)(a.InspectorControls,null,(0,n.createElement)(l.PanelBody,{title:window.fifuBlockStrings.label.settings},(0,n.createElement)(l.TextControl,{label:window.fifuBlockStrings.label.image,value:r||"",placeholder:window.fifuBlockStrings.placeholder.paste,onChange:e=>{t({imageUrl:e}),w(!1)}}),r&&(0,n.createElement)(n.Fragment,null,(0,n.createElement)(l.TextControl,{label:window.fifuBlockStrings.label.alt,value:s,onChange:e=>t({altText:e})}),(0,n.createElement)("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"}},window.fifuBlockStrings.help.alt),(0,n.createElement)(l.Button,{isLink:!0,isDestructive:!0,onClick:()=>{t({imageUrl:"",altText:""}),w(!1)},style:{marginTop:8}},window.fifuBlockStrings.link.remove)))),r?(0,n.createElement)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}},(0,n.createElement)("img",{src:f?"https://storage.googleapis.com/featuredimagefromurl/image-not-found-a.jpg":r,alt:s,style:{maxWidth:"100%",borderRadius:4,border:"1px solid #eee",background:"#fff"},onError:()=>w(!0)})):(0,n.createElement)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%",minHeight:"180px",background:"#f0f0f0",border:"1px dashed #ccc",borderRadius:"4px",color:"#888",margin:"12px 0"}},(0,n.createElement)("span",null,window.fifuBlockStrings.label.set)))},save:()=>null})})();